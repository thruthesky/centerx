(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a8082272"],{"11c8":function(t,e,s){"use strict";var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[s("path",{attrs:{d:"M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"}})])},o=[],n=s("2877"),i={},a=Object(n["a"])(i,r,o,!1,null,null,null);e["a"]=a.exports},"38ba":function(t,e,s){"use strict";s("f0f5")},"450c":function(t,e,s){"use strict";var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"pr-2 position-relative overflow-hidden pointer"},[s("camera-svg",{staticClass:"pointer",style:{width:t.defaultSize+"px",height:t.defaultSize+"px"}}),s("input",{staticClass:"h-100 top right position-absolute fs-lg opacity-0 pointer",attrs:{type:"file"},on:{change:t.onFileChange}})],1)},o=[],n=(s("d3b7"),s("9ab4")),i=s("2b0e"),a=s("2fe1"),c=s("9f3a"),u=s("190e"),l=s("11c8"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultSize=35,e.api=c["a"].instance,e}return Object(n["c"])(e,t),e.prototype.mounted=function(){this.size&&(this.defaultSize=this.size)},e.prototype.onFileChange=function(t){var e,s;return Object(n["a"])(this,void 0,Promise,(function(){var r,o,i;return Object(n["d"])(this,(function(n){switch(n.label){case 0:if(!this.api._user.loggedIn)return u["b"].instance.error("error_login_first"),[2];if(null===t.target.files||0===(null===(s=null===(e=t.target)||void 0===e?void 0:e.files)||void 0===s?void 0:s.length))return[2];r=t.target.files[0],n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.api.fileUpload(r,{},this.onProgress)];case 2:return o=n.sent(),this.$emit("success",o),[3,4];case 3:return i=n.sent(),u["b"].instance.error(i),[3,4];case 4:return[2]}}))}))},e.prototype.onProgress=function(t){console.log(t),this.$emit("progress",t)},e=Object(n["b"])([Object(a["b"])({props:["size"],components:{CameraSvg:l["a"]}})],e),e}(i["default"]),d=p,h=d,f=s("2877"),m=Object(f["a"])(h,r,o,!1,null,null,null);e["a"]=m.exports},"5ab4":function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.chat.room.id?s("ChatMessageList"):t._e()],1)},o=[],n=(s("d3b7"),s("ac1f"),s("1276"),s("9ab4")),i=s("2b0e"),a=s("1b40"),c=s("0dc0"),u=s("e982"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"chat-message d-flex flex-column"},[s("div",{staticClass:"d-flex justify-content-between mb-2"},[s("div",{staticClass:"admin-user-avatar d-flex align-items-center text-nowrap"},[s("UserAvatar",{staticClass:"mr-2",attrs:{user:t.otherUser}}),s("div",[t.room.getTitle?s("div",[t._v(t._s(t.room.getTitle))]):t.otherUser.idx?s("div",[t._v("("+t._s(t.otherUser.idx)+") "+t._s(t.otherUser.nicknameOrName))]):t._e()])],1),s("div",{staticClass:"chat-options d-flex align-items-center"},[s("PushNotificationIcon",{attrs:{rawTopic:t.room.topic,subscribedByDefault:!0}}),s("button",{staticClass:"btn btn-sm py-2",attrs:{id:"chat-options-popover-"+t.room.global.roomId}},[s("font-awesome-icon",{attrs:{icon:["fas","cog"],size:"lg"}})],1),s("router-link",{staticClass:"btn btn-sm py-2 pointer",attrs:{to:"/chat"}},[s("font-awesome-icon",{attrs:{icon:["fas","times"],size:"lg"}})],1),s("b-popover",{ref:"popover",attrs:{placement:"bottomleft",target:"chat-options-popover-"+t.room.global.roomId,triggers:"click blur"}},[s("div",{staticClass:"p-2 pointer",on:{click:t.changeRoomTitle}},[s("font-awesome-icon",{staticClass:"mr-2",attrs:{icon:["fas","edit"]}}),t._v(" "+t._s(t._f("t")("edit_room_title"))+" ")],1),s("router-link",{staticClass:"p-2 pointer",attrs:{to:"/chat"}},[s("font-awesome-icon",{staticClass:"mr-2",attrs:{icon:["fas","list"]}}),t._v(" "+t._s(t._f("t")("goto_room_list"))+" ")],1),s("div",{staticClass:"p-2 pointer",on:{click:t.leaveRoom}},[s("font-awesome-icon",{staticClass:"mr-2",attrs:{icon:["fas","sign-out-alt"]}}),t._v(" "+t._s(t._f("t")("leave_room"))+" ")],1)],1)],1)]),s("div",{staticClass:"d-flex flex-column overflow-auto flex-grow-1 mb-2",attrs:{id:t.room.messageListId},on:{scroll:function(e){return t.room.scrollEventHandler()}}},[s("div",{staticClass:"flex-grow-1"}),t.room.loading?s("div",{staticClass:"py-2 mx-auto"},[s("b-spinner")],1):t._e(),t._l(t.room.messages,(function(e){return s("div",{key:e.id,staticClass:"chat-bubble mb-1 rounded-lg my-1 p-2 text-break white",class:e.isMine?"text-right my-chat ml-auto":"text-left other-chat mr-auto",attrs:{id:"chat-message-popover-"+e.id}},[e.canEdit?s("b-popover",{ref:"popover",refInFor:!0,attrs:{placement:"left",target:"chat-message-popover-"+e.id,triggers:"hover focus"}},[s("div",{staticClass:"pointer",on:{click:function(s){return t.room.editMessage(e)}}},[s("font-awesome-icon",{staticClass:"mr-2",attrs:{icon:["fas","edit"]}}),t._v(" "+t._s(t._f("t")("edit"))+" ")],1)]):t._e(),e.isMine?s("div",{on:{mousedown:function(s){return t.onMouseDown(e)},mouseup:function(s){return t.onMouseUp(e)}}},[e.isImage?t._e():s("div",[t._v(t._s(t.room.text(e,!0)))]),e.isImage?s("div",[e.rendered?t._e():s("b-spinner"),s("b-img",{attrs:{src:e.text,fluid:"",alt:e.text},on:{load:function(s){return t.room.onImageLoadComplete(e)},click:function(s){return s.preventDefault(),t.showImagePreview(e)}}})],1):t._e()]):s("div",[e.isImage?t._e():s("div",[t._v(t._s(t.room.text(e,!0)))]),e.isImage?s("div",[e.rendered?t._e():s("b-spinner"),s("b-img",{attrs:{src:e.text,fluid:"",alt:e.text},on:{load:function(s){return t.room.onImageLoadComplete(e)},click:function(s){return s.preventDefault(),t.showImagePreview(e)}}})],1):t._e()])],1)}))],2),t.progress&&100!=t.progress?s("b-progress",{staticClass:"mb-3 ml-2 mr-2",attrs:{value:t.progress,max:"100"}}):t._e(),s("div",{staticClass:"d-flex"},[s("div",[s("UploadButton",{on:{success:t.onSuccess,progress:function(e){t.progress=e}}})],1),s("div",{staticClass:"w-100 position-relative"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.room.textInput,expression:"room.textInput"}],ref:"testInput",staticClass:"w-100 py-1",attrs:{type:"text"},domProps:{value:t.room.textInput},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage.apply(null,arguments)},input:function(e){e.target.composing||t.$set(t.room,"textInput",e.target.value)}}}),t.room.isMessageEdit?s("div",{staticClass:"red position-absolute top right py-1 px-2",on:{click:function(e){return t.room.cancelEdit()}}},[s("font-awesome-icon",{attrs:{icon:["fas","times"]}})],1):t._e()]),s("button",{staticClass:"btn btn-sm btn-primary ml-2 px-5",on:{click:t.sendMessage}},[t._v(t._s(t._f("t")("Send")))])]),s("b-modal",{attrs:{id:"file-preview-modal","hide-footer":""},scopedSlots:t._u([{key:"modal-title",fn:function(){return[t._v(t._s(t.fileImagePreviewUrl))]},proxy:!0}])},[s("div",[s("b-img",{attrs:{src:t.fileImagePreviewUrl,fluid:"",alt:t.fileImagePreviewUrl}})],1),s("b-button",{staticClass:"mt-3",attrs:{block:""},on:{click:function(e){return t.$bvModal.hide("file-preview-modal")}}},[t._v("Close")])],1)],1)},p=[],d=(s("498a"),s("466c")),h=s("9f3a"),f=s("190e"),m=s("a6e8"),b=s("450c"),v=s("5803"),g=s("1821"),y=s("a51d"),_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.room=u["a"].instance,e.sending=!1,e.chatRoomSubscription=new m["a"],e.otherUser=new d["g"],e.fileImagePreviewUrl="",e.progress=0,e}return Object(n["c"])(e,t),e.prototype.showImagePreview=function(t){this.fileImagePreviewUrl=""+t.extra.url,this.$bvModal.show("file-preview-modal")},e.prototype.mounted=function(){this.chatRoomSubscription=u["a"].instance.changes.subscribe((function(){(u["a"].instance.atBottom||1==u["a"].instance.page)&&u["a"].instance.scrollToBottom()})),this.loadOtherUser()},e.prototype.loadOtherUser=function(){return Object(n["a"])(this,void 0,Promise,(function(){var t,e,s;return Object(n["d"])(this,(function(r){switch(r.label){case 0:if(!u["a"].instance.global.otherUserId)return[2];t=u["a"].instance.global.otherUserId,r.label=1;case 1:return r.trys.push([1,3,,4]),e=this,[4,h["a"].instance.otherUserProfile(t)];case 2:return e.otherUser=r.sent(),[3,4];case 3:return s=r.sent(),f["b"].instance.error(s),[3,4];case 4:return[2]}}))}))},e.prototype.destroyed=function(){console.log("ChatMessageListScreen::destroyed()"),u["a"].instance.unsubscribe(),this.chatRoomSubscription.unsubscribe()},e.prototype.sendMessage=function(){var t;return Object(n["a"])(this,void 0,Promise,(function(){var e,s;return Object(n["d"])(this,(function(r){switch(r.label){case 0:if(0==this.room.textInput.trim().length||this.sending)return[2];this.sending=!0,e=this.room.textInput,this.room.textInput="",r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.room.sendMessage({text:e,displayName:h["a"].instance._user.nicknameOrName})];case 2:return r.sent(),this.sending=!1,null===(t=this.$refs.testInput)||void 0===t||t.focus(),[3,4];case 3:return s=r.sent(),f["b"].instance.error(s),this.sending=!1,[3,4];case 4:return[2]}}))}))},e.prototype.changeRoomTitle=function(){return Object(n["a"])(this,void 0,Promise,(function(){var t=this;return Object(n["d"])(this,(function(e){return f["b"].instance.promptToast({title:"Change Room Title",message:this.room.getTitle,placement:f["a"].TOP_CENTER,okCallback:function(e){return Object(n["a"])(t,void 0,Promise,(function(){var t;return Object(n["d"])(this,(function(s){switch(s.label){case 0:console.log("title",e),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.room.updateTitle(e)];case 2:return s.sent(),[3,4];case 3:return t=s.sent(),f["b"].instance.error(t),[3,4];case 4:return[2]}}))}))}}),[2]}))}))},e.prototype.leaveRoom=function(){return Object(n["a"])(this,void 0,Promise,(function(){var t,e;return Object(n["d"])(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,f["b"].instance.confirm("Chat Room delete","Do you want to delete this chat room?")];case 1:return t=s.sent(),!1===t?[2]:[4,this.room.leave()];case 2:return s.sent(),this.$router.push("/chat"),[3,4];case 3:return e=s.sent(),f["b"].instance.error(e),[3,4];case 4:return[2]}}))}))},e.prototype.onSuccess=function(t){var e;return Object(n["a"])(this,void 0,Promise,(function(){var s;return Object(n["d"])(this,(function(r){switch(r.label){case 0:console.log("onSuccess::",t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.room.sendMessage({text:Object(g["a"])(t.url)?t.thumbnailUrl:t.url,displayName:h["a"].instance._user.nicknameOrName,extra:{url:t.url}})];case 2:return r.sent(),this.sending=!1,null===(e=this.$refs.testInput)||void 0===e||e.focus(),[3,4];case 3:return s=r.sent(),f["b"].instance.error(s),this.sending=!1,[3,4];case 4:return[2]}}))}))},e.prototype.onMouseDown=function(t){console.log(t.isImage),t.isMine&&(t.longPress=!0,setTimeout((function(){t.longPress&&console.log("show edit")}),2e3))},e.prototype.onMouseUp=function(t){t.isMine&&(t.longPress=!1)},e=Object(n["b"])([Object(a["a"])({components:{UserAvatar:v["a"],UploadButton:b["a"],PushNotificationIcon:y["a"]}})],e),e}(a["c"]),w=_,O=w,x=(s("38ba"),s("2877")),j=Object(x["a"])(O,l,p,!1,null,"08a5a8df",null),C=j.exports,I=s("d68b"),U=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.chat=c["a"].instance,e}return Object(n["c"])(e,t),e.prototype.mounted=function(){this.enter()},e.prototype.enter=function(){return Object(n["a"])(this,void 0,Promise,(function(){var t,e,s,r,o;return Object(n["d"])(this,(function(n){switch(n.label){case 0:if(t={displayName:I["a"].instance.user.displayName},null!=this.$route.query.id)t.id=""+this.$route.query.id;else{if(!this.$route.query.uid)return[2,I["a"].instance.alert("Missing params","missing id or users firebaseUid")];t.users=this.$route.query.uid.split(",")}null!=this.$route.query.hatch&&(t.hatch="true"==this.$route.query.hatch),n.label=1;case 1:return n.trys.push([1,5,,6]),[4,u["a"].instance.enter(t)];case 2:return n.sent(),this.chat.room.global.otherUserId&&this.chat.room.isModerator?[4,h["a"].instance.otherUserProfile(this.chat.room.global.otherUserId)]:[3,4];case 3:e=n.sent(),o={},o[e.firebaseUid]={photoUrl:e.photoUrl,displayName:e.nicknameOrName},o[this.chat.room.loginUserUid]={photoUrl:h["a"].instance._user.photoUrl,displayName:h["a"].instance._user.nicknameOrName},s=o,this.chat.room.updateGlobalRoomUsersInfo(s),n.label=4;case 4:return[3,6];case 5:return r=n.sent(),this.$app.error(r),[3,6];case 6:return[2]}}))}))},e=Object(n["b"])([Object(a["a"])({components:{ChatMessageList:C}})],e),e}(i["default"]),k=U,T=k,P=Object(x["a"])(T,r,o,!1,null,null,null);e["default"]=P.exports},a51d:function(t,e,s){"use strict";var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"push-notification-icon"},[s("b-form-checkbox",{attrs:{name:"check-button",switch:""},on:{change:t.onChangeSubscribeOrUnsubscribeTopic},model:{value:t.data[t.postTopic],callback:function(e){t.$set(t.data,t.postTopic,e)},expression:"data[postTopic]"}},[s("span",[t._v(t._s(t._f("t")(t.title)))])])],1)},o=[],n=(s("d3b7"),s("9ab4")),i=s("9f3a"),a=s("190e"),c=s("1b40"),u=function(t){function e(){var e,s=null!==t&&t.apply(this,arguments)||this;return s.data=(e={},e[s.postTopic]=!1,e),s}return Object(n["c"])(e,t),Object.defineProperty(e.prototype,"postTopic",{get:function(){return this.rawTopic.length?this.rawTopic:"notifyPost_"+this.topic},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){return Object(n["a"])(this,void 0,Promise,(function(){var t,e;return Object(n["d"])(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,i["a"].instance.isSubscribedToTopic(this.postTopic,this.subscribedByDefault)];case 1:return t=s.sent(),this.data[this.postTopic]="Y"===t[this.postTopic],[3,3];case 2:return e=s.sent(),a["b"].instance.error(e),[3,3];case 3:return[2]}}))}))},e.prototype.onChangeSubscribeOrUnsubscribeTopic=function(){return Object(n["a"])(this,void 0,Promise,(function(){var t;return Object(n["d"])(this,(function(e){switch(e.label){case 0:if(!i["a"].instance._user.loggedIn)return this.data[this.postTopic]=!1,a["b"].instance.error("error_login_first"),[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,i["a"].instance.topicSubscription({topic:this.postTopic,subscribe:this.data[this.postTopic]?"Y":"N"})];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),a["b"].instance.error(t),[3,4];case 4:return[2]}}))}))},Object(n["b"])([Object(c["b"])({default:"defaultTopic"})],e.prototype,"topic",void 0),Object(n["b"])([Object(c["b"])({default:""})],e.prototype,"rawTopic",void 0),Object(n["b"])([Object(c["b"])({default:""})],e.prototype,"title",void 0),Object(n["b"])([Object(c["b"])({default:!1})],e.prototype,"subscribedByDefault",void 0),e=Object(n["b"])([Object(c["a"])({})],e),e}(c["c"]),l=u,p=l,d=s("2877"),h=Object(d["a"])(p,r,o,!1,null,null,null);e["a"]=h.exports},f0f5:function(t,e,s){}}]);
//# sourceMappingURL=chunk-a8082272.c7447dab.js.map