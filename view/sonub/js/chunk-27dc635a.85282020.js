(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27dc635a"],{"11c8":function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[s("path",{attrs:{d:"M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"}})])},r=[],i=s("2877"),n={},a=Object(i["a"])(n,o,r,!1,null,null,null);e["a"]=a.exports},"3a8d":function(t,e,s){"use strict";s("6c59")},"450c":function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"pr-2 position-relative overflow-hidden pointer"},[s("camera-svg",{staticClass:"pointer",style:{width:t.defaultSize+"px",height:t.defaultSize+"px"}}),s("input",{staticClass:"h-100 top right position-absolute fs-lg opacity-0 pointer",attrs:{type:"file"},on:{change:t.onFileChange}})],1)},r=[],i=(s("d3b7"),s("9ab4")),n=s("2b0e"),a=s("2fe1"),c=s("9f3a"),l=s("190e"),u=s("11c8"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultSize=35,e.api=c["a"].instance,e}return Object(i["c"])(e,t),e.prototype.mounted=function(){this.size&&(this.defaultSize=this.size)},e.prototype.onFileChange=function(t){var e,s;return Object(i["a"])(this,void 0,Promise,(function(){var o,r,n;return Object(i["d"])(this,(function(i){switch(i.label){case 0:if(!this.api.user.loggedIn)return l["b"].instance.error("error_login_first"),[2];if(null===t.target.files||0===(null===(s=null===(e=t.target)||void 0===e?void 0:e.files)||void 0===s?void 0:s.length))return[2];o=t.target.files[0],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.api.fileUpload(o,{},this.onProgress)];case 2:return r=i.sent(),this.$emit("success",r),[3,4];case 3:return n=i.sent(),l["b"].instance.error(n),[3,4];case 4:return[2]}}))}))},e.prototype.onProgress=function(t){console.log(t),this.$emit("progress",t)},e=Object(i["b"])([Object(a["b"])({props:["size"],components:{CameraSvg:u["a"]}})],e),e}(n["default"]),d=p,h=d,m=s("2877"),b=Object(m["a"])(h,o,r,!1,null,null,null);e["a"]=b.exports},"6c59":function(t,e,s){},a51d:function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"push-notification-icon"},[s("b-form-checkbox",{attrs:{name:"check-button",switch:""},on:{change:t.onChangeSubscribeOrUnsubscribeTopic},model:{value:t.data[t.postTopic],callback:function(e){t.$set(t.data,t.postTopic,e)},expression:"data[postTopic]"}},[s("span",[t._v(t._s(t._f("t")(t.title)))])])],1)},r=[],i=(s("d3b7"),s("9ab4")),n=s("9f3a"),a=s("190e"),c=s("1b40"),l=function(t){function e(){var e,s=null!==t&&t.apply(this,arguments)||this;return s.data=(e={},e[s.postTopic]=!1,e),s}return Object(i["c"])(e,t),Object.defineProperty(e.prototype,"postTopic",{get:function(){return this.rawTopic.length?this.rawTopic:"notifyPost_"+this.topic},enumerable:!1,configurable:!0}),e.prototype.mounted=function(){return Object(i["a"])(this,void 0,Promise,(function(){var t,e;return Object(i["d"])(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,n["a"].instance.isSubscribedToTopic(this.postTopic,this.subscribedByDefault)];case 1:return t=s.sent(),this.data[this.postTopic]="Y"===t[this.postTopic],[3,3];case 2:return e=s.sent(),a["b"].instance.error(e),[3,3];case 3:return[2]}}))}))},e.prototype.onChangeSubscribeOrUnsubscribeTopic=function(){return Object(i["a"])(this,void 0,Promise,(function(){var t;return Object(i["d"])(this,(function(e){switch(e.label){case 0:if(!n["a"].instance.user.loggedIn)return this.data[this.postTopic]=!1,a["b"].instance.error("error_login_first"),[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,n["a"].instance.topicSubscription({topic:this.postTopic,subscribe:this.data[this.postTopic]?"Y":"N"})];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),a["b"].instance.error(t),[3,4];case 4:return[2]}}))}))},Object(i["b"])([Object(c["b"])({default:"defaultTopic"})],e.prototype,"topic",void 0),Object(i["b"])([Object(c["b"])({default:""})],e.prototype,"rawTopic",void 0),Object(i["b"])([Object(c["b"])({default:""})],e.prototype,"title",void 0),Object(i["b"])([Object(c["b"])({default:!1})],e.prototype,"subscribedByDefault",void 0),e=Object(i["b"])([Object(c["a"])({})],e),e}(c["c"]),u=l,p=u,d=s("2877"),h=Object(d["a"])(p,o,r,!1,null,null,null);e["a"]=h.exports},f8c9:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.room.id?s("ChatRoom"):t._e()],1)},r=[],i=(s("d3b7"),s("ac1f"),s("1276"),s("b64b"),s("9ab4")),n=s("2b0e"),a=s("1b40"),c=s("e982"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"chat-message d-flex flex-column"},[s("div",{staticClass:"d-flex justify-content-between mb-2"},[s("div",{staticClass:"admin-user-avatar d-flex align-items-center text-nowrap"},[s("UserAvatar",{staticClass:"mr-2",attrs:{user:t.otherUser}}),s("div",[t.room.getTitle?s("div",[t._v(t._s(t.room.getTitle))]):t.otherUser.idx?s("div",[t._v("("+t._s(t.otherUser.idx)+") "+t._s(t.otherUser.nicknameOrName))]):t._e()])],1),s("div",{staticClass:"chat-options d-flex align-items-center"},[s("PushNotificationIcon",{attrs:{rawTopic:t.room.topic,subscribedByDefault:!0}}),s("button",{staticClass:"btn btn-sm py-2",attrs:{id:"chat-options-popover-"+t.room.global.roomId}},[s("font-awesome-icon",{attrs:{icon:["fas","cog"],size:"lg"}})],1),s("router-link",{staticClass:"btn btn-sm py-2 pointer",attrs:{to:"/chat"}},[s("font-awesome-icon",{attrs:{icon:["fas","times"],size:"lg"}})],1),s("b-popover",{ref:"popover",attrs:{placement:"bottomleft",target:"chat-options-popover-"+t.room.global.roomId,triggers:"click blur"}},[s("div",{staticClass:"p-2 pointer",on:{click:t.changeRoomTitle}},[s("font-awesome-icon",{staticClass:"mr-2",attrs:{icon:["fas","edit"]}}),t._v(" "+t._s(t._f("t")("edit_room_title"))+" ")],1),s("router-link",{staticClass:"p-2 pointer",attrs:{to:"/chat"}},[s("font-awesome-icon",{staticClass:"mr-2",attrs:{icon:["fas","list"]}}),t._v(" "+t._s(t._f("t")("goto_room_list"))+" ")],1),s("div",{staticClass:"p-2 pointer",on:{click:t.leaveRoom}},[s("font-awesome-icon",{staticClass:"mr-2",attrs:{icon:["fas","sign-out-alt"]}}),t._v(" "+t._s(t._f("t")("leave_room"))+" ")],1)],1)],1)]),s("div",{staticClass:"d-flex flex-column overflow-auto flex-grow-1 mb-2",attrs:{id:t.room.messageListId},on:{scroll:function(e){return t.room.scrollEventHandler()}}},[s("div",{staticClass:"flex-grow-1"}),t.room.loading?s("div",{staticClass:"py-2 mx-auto"},[s("b-spinner")],1):t._e(),t._l(t.room.messages,(function(e){return s("div",{key:e.id,staticClass:"chat-bubble mb-1 rounded-lg my-1 p-2 text-break white",class:e.isMine?"text-right my-chat ml-auto":"text-left other-chat mr-auto",attrs:{id:"chat-message-popover-"+e.id}},[e.canEdit?s("b-popover",{ref:"popover",refInFor:!0,attrs:{placement:"left",target:"chat-message-popover-"+e.id,triggers:"hover focus"}},[s("div",{staticClass:"pointer",on:{click:function(s){return t.room.editMessage(e)}}},[s("font-awesome-icon",{staticClass:"mr-2",attrs:{icon:["fas","edit"]}}),t._v(" "+t._s(t._f("t")("edit"))+" ")],1)]):t._e(),e.isMine?s("div",{on:{mousedown:function(s){return t.onMouseDown(e)},mouseup:function(s){return t.onMouseUp(e)}}},[e.isImage?s("div",[e.rendered?t._e():s("b-spinner"),s("b-img",{attrs:{src:e.text,fluid:"",alt:e.text},on:{load:function(s){return t.room.onImageLoadComplete(e)},click:function(s){return s.preventDefault(),t.showImagePreview(e)}}})],1):e.isMovie?s("div",[s("video",{attrs:{width:"320",height:"240",controls:""}},[s("source",{attrs:{src:e.text}}),t._v(" Your browser does not support the video tag. ")])]):s("div",[t._v(t._s(t.room.text(e,!0)))])]):s("div",[e.isImage?s("div",[e.rendered?t._e():s("b-spinner"),s("b-img",{attrs:{src:e.text,fluid:"",alt:e.text},on:{load:function(s){return t.room.onImageLoadComplete(e)},click:function(s){return s.preventDefault(),t.showImagePreview(e)}}})],1):e.isMovie?s("div",[s("video",{attrs:{width:"320",height:"240",controls:""}},[s("source",{attrs:{src:e.text}}),t._v(" Your browser does not support the video tag. ")])]):s("div",[t._v(t._s(t.room.text(e,!0)))])])],1)}))],2),t.progress&&100!=t.progress?s("b-progress",{staticClass:"mb-3 ml-2 mr-2",attrs:{value:t.progress,max:"100"}}):t._e(),s("div",{staticClass:"d-flex"},[s("div",[s("UploadButton",{on:{success:t.onSuccess,progress:function(e){t.progress=e}}})],1),s("div",{staticClass:"w-100 position-relative"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.room.textInput,expression:"room.textInput"}],ref:"testInput",staticClass:"w-100 py-1",attrs:{type:"text"},domProps:{value:t.room.textInput},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage.apply(null,arguments)},input:function(e){e.target.composing||t.$set(t.room,"textInput",e.target.value)}}}),t.room.isMessageEdit?s("div",{staticClass:"red position-absolute top right py-1 px-2",on:{click:function(e){return t.room.cancelEdit()}}},[s("font-awesome-icon",{attrs:{icon:["fas","times"]}})],1):t._e()]),s("button",{staticClass:"btn btn-sm btn-primary ml-2 px-5",on:{click:t.sendMessage}},[t._v(t._s(t._f("t")("Send")))])]),s("b-modal",{attrs:{id:"file-preview-modal","hide-footer":""},scopedSlots:t._u([{key:"modal-title",fn:function(){return[t._v(t._s(t.fileImagePreviewUrl))]},proxy:!0}])},[s("div",[s("b-img",{attrs:{src:t.fileImagePreviewUrl,fluid:"",alt:t.fileImagePreviewUrl}})],1),s("b-button",{staticClass:"mt-3",attrs:{block:""},on:{click:function(e){return t.$bvModal.hide("file-preview-modal")}}},[t._v("Close")])],1)],1)},u=[],p=(s("498a"),s("466c")),d=s("9f3a"),h=s("190e"),m=s("a6e8"),b=s("450c"),f=s("5803"),g=s("1821"),v=s("a51d"),y=s("d661"),U=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.room=c["a"].instance,e.sending=!1,e.chatRoomSubscription=new m["a"],e.otherUser=new p["g"],e.fileImagePreviewUrl="",e.progress=0,e}return Object(i["c"])(e,t),e.prototype.showImagePreview=function(t){this.fileImagePreviewUrl=""+t.extra.url,this.$bvModal.show("file-preview-modal")},e.prototype.mounted=function(){this.chatRoomSubscription=c["a"].instance.changes.subscribe((function(){(c["a"].instance.atBottom||1==c["a"].instance.page)&&c["a"].instance.scrollToBottom()})),this.loadOtherUser()},e.prototype.loadOtherUser=function(){return Object(i["a"])(this,void 0,Promise,(function(){var t,e,s;return Object(i["d"])(this,(function(o){switch(o.label){case 0:if(!c["a"].instance.global.otherUserId)return[2];t=c["a"].instance.global.otherUserId,o.label=1;case 1:return o.trys.push([1,3,,4]),e=this,[4,d["a"].instance.otherUserProfile(t)];case 2:return e.otherUser=o.sent(),[3,4];case 3:return s=o.sent(),h["b"].instance.error(s),[3,4];case 4:return[2]}}))}))},e.prototype.destroyed=function(){console.log("ChatMessageListScreen::destroyed()"),c["a"].instance.unsubscribe(),this.chatRoomSubscription.unsubscribe()},e.prototype.sendMessage=function(){var t;return Object(i["a"])(this,void 0,Promise,(function(){var e,s,o;return Object(i["d"])(this,(function(r){switch(r.label){case 0:if(0==this.room.textInput.trim().length||this.sending)return[2];this.sending=!0,e=this.room.textInput,this.room.textInput="",r.label=1;case 1:return r.trys.push([1,3,,4]),s=this.room.isMessageEdit,[4,this.room.sendMessage({text:e,displayName:d["a"].instance.user.nicknameOrName})];case 2:return r.sent(),this.sending=!1,null===(t=this.$refs.testInput)||void 0===t||t.focus(),null==s&&d["a"].instance.sendMessageToUsers({users:this.room.otherUserId,subscription:this.room.topic,title:d["a"].instance.user.nicknameOrName+" "+Object(y["g"])("sent_a_message"),body:e,click_action:"chat-message?id="+this.room.id,data:{type:"chat",roomId:this.room.id}}),[3,4];case 3:return o=r.sent(),h["b"].instance.error(o),this.sending=!1,[3,4];case 4:return[2]}}))}))},e.prototype.changeRoomTitle=function(){return Object(i["a"])(this,void 0,Promise,(function(){var t=this;return Object(i["d"])(this,(function(e){return h["b"].instance.promptToast({title:"Change Room Title",message:this.room.getTitle,placement:h["a"].TOP_CENTER,okCallback:function(e){return Object(i["a"])(t,void 0,Promise,(function(){var t;return Object(i["d"])(this,(function(s){switch(s.label){case 0:console.log("title",e),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.room.updateTitle(e)];case 2:return s.sent(),[3,4];case 3:return t=s.sent(),h["b"].instance.error(t),[3,4];case 4:return[2]}}))}))}}),[2]}))}))},e.prototype.leaveRoom=function(){return Object(i["a"])(this,void 0,Promise,(function(){var t,e;return Object(i["d"])(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,h["b"].instance.confirm("Chat Room delete","Do you want to delete this chat room?")];case 1:return t=s.sent(),!1===t?[2]:[4,this.room.leave()];case 2:return s.sent(),this.$router.push("/chat"),[3,4];case 3:return e=s.sent(),h["b"].instance.error(e),[3,4];case 4:return[2]}}))}))},e.prototype.onSuccess=function(t){var e;return Object(i["a"])(this,void 0,Promise,(function(){var s;return Object(i["d"])(this,(function(o){switch(o.label){case 0:console.log("onSuccess::",t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.room.sendMessage({text:Object(g["a"])(t.url)?t.thumbnailUrl:t.url,displayName:d["a"].instance.user.nicknameOrName,extra:{url:t.url}})];case 2:return o.sent(),this.sending=!1,d["a"].instance.sendMessageToUsers({users:this.room.otherUserId,subscription:this.room.topic,title:d["a"].instance.user.nicknameOrName+" "+Object(y["g"])("sent_a_message"),body:Object(y["g"])("sent_a_file"),click_action:"chat-message?id="+this.room.id,data:{type:"chat",roomId:this.room.id}}),null===(e=this.$refs.testInput)||void 0===e||e.focus(),[3,4];case 3:return s=o.sent(),h["b"].instance.error(s),this.sending=!1,[3,4];case 4:return[2]}}))}))},e.prototype.onMouseDown=function(t){console.log(t.isImage),t.isMine&&(t.longPress=!0,setTimeout((function(){t.longPress&&console.log("show edit")}),2e3))},e.prototype.onMouseUp=function(t){t.isMine&&(t.longPress=!1)},e=Object(i["b"])([Object(a["a"])({components:{UserAvatar:f["a"],UploadButton:b["a"],PushNotificationIcon:v["a"]}})],e),e}(a["c"]),O=U,w=O,_=(s("3a8d"),s("2877")),j=Object(_["a"])(w,l,u,!1,null,"4931d64e",null),x=j.exports,C=s("d68b"),k=s("0613"),I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.room=c["a"].instance,e}return Object(i["c"])(e,t),e.prototype.mounted=function(){this.enter()},e.prototype.watchRoute=function(){this.enter()},e.prototype.watchUid=function(){this.enter()},e.prototype.enter=function(){return Object(i["a"])(this,void 0,Promise,(function(){var t,e,s,o,r,n,a,c;return Object(i["d"])(this,(function(i){switch(i.label){case 0:if(t={displayName:C["a"].instance.user.displayName},null!=this.$route.query.id)t.id=""+this.$route.query.id;else{if(!this.$route.query.uid)return[2,C["a"].instance.alert("Missing params","missing id or users firebaseUid")];t.users=this.$route.query.uid.split(",")}i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.room.enter(t)];case 2:return i.sent(),this.room.global.otherUserId?[4,d["a"].instance.otherUserProfile(this.room.global.otherUserId)]:[3,4];case 3:e=i.sent(),s=d["a"].instance.user,console.log("enter::otherUserProfile::",e),console.log("enter::userProfile::",s),o={},this.room.global.usersInfo?(r=this.room.global.usersInfo[e.firebaseUid],r?(r.displayName!=e.nicknameOrName&&(o[e.firebaseUid]||(o[e.firebaseUid]={}),o[e.firebaseUid].displayName=e.nicknameOrName),r.photoUrl!=e.photoUrl&&(o[e.firebaseUid]||(o[e.firebaseUid]={}),o[e.firebaseUid].photoUrl=e.photoUrl)):o[e.firebaseUid]={photoUrl:e.photoUrl,displayName:e.nicknameOrName},n=this.room.global.usersInfo[this.room.loginUserUid],n?(n.displayName!=k["a"].state.user.nicknameOrName&&(o[this.room.loginUserUid]||(o[this.room.loginUserUid]={}),o[this.room.loginUserUid].displayName=k["a"].state.user.nicknameOrName),console.log(n.photoUrl,k["a"].state.user.photoUrl),n.photoUrl!=k["a"].state.user.photoUrl&&(o[this.room.loginUserUid]||(o[this.room.loginUserUid]={}),o[this.room.loginUserUid].photoUrl=k["a"].state.user.photoUrl)):o[this.room.loginUserUid]={photoUrl:k["a"].state.user.photoUrl,displayName:k["a"].state.user.nicknameOrName}):(c={},c[e.firebaseUid]={photoUrl:e.photoUrl,displayName:e.nicknameOrName},c[this.room.loginUserUid]={photoUrl:k["a"].state.user.photoUrl,displayName:k["a"].state.user.nicknameOrName},o=c),console.log("usersInfo::",Object.keys(o).length,o),Object.keys(o).length&&this.room.updateGlobalRoomUsersInfo(o),i.label=4;case 4:return[3,6];case 5:return a=i.sent(),this.$app.error(a),[3,6];case 6:return[2]}}))}))},Object(i["b"])([Object(a["d"])("$route.query.id")],e.prototype,"watchRoute",null),Object(i["b"])([Object(a["d"])("$route.query.uid")],e.prototype,"watchUid",null),e=Object(i["b"])([Object(a["a"])({components:{ChatRoom:x}})],e),e}(n["default"]),T=I,P=T,N=Object(_["a"])(P,o,r,!1,null,null,null);e["default"]=N.exports}}]);
//# sourceMappingURL=chunk-27dc635a.85282020.js.map