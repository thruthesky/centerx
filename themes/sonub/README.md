# 소너브 개발

## 해야 할 일

* [CenterX Sonub 깃 프로젝트 참고](https://github.com/thruthesky/centerx/projects/1)

* 모바일 먼저.
  
* 로그인 기능.
  - 메일주소/비번, 네이버, 카톡 3가지로 한다.
    - 네이버와 카톡은 성별, 나이를 입력 받지 않는다.
    - 즉, 로그인 기능 자체는 편하게 개발 가능하고, 사용자도 편하게 로그인 가능하다.

* 본인 인증
  - 위 3가지 중 하나로 로그인 한 후,
  - 본인 인증 메뉴에서, 패스로그인 또는 다날로 인증을 하도록 한다. 즉, 한번만 인증하면 되는 것이다.
  - 특히, 다날은 필수적으로 하고, 패스로그인은 검수 통과하면 사용한다.
  
  
* CSS 는 아주 기본되는 공통 class 만, index.css 두고, 나머지는 각 페이지에서 inline style 로 작업한다.
  
- GeoIP 국가 정보 활용 방법
  - 국가 코드 2자리 2차 도메인을 만들지 못하도록 한다.
  
- 로직. 카페 국가.
  - sonub.com 은 전 세계의 메인 도메인이다.
    - 각 국가별로 도메인을 지정해서 사용할 수 있는데, `CAFE_COUNTRY_DOMAINS` 에 기록한다.
    - 국가 코드 2자리로 `kr.sonub.com`, `jp.sonub.com` 과 같이 접속을 하면 자동으로 그 국가의 메인 도메인이 된다.
    
  - sonub.com 또는 sonub.com 의 메인 도메인으로 접속한 경우,
    - 한국에서 접속했으면,
      - 국가 선택을 해서, 해당 국가 도메인으로 이동 할 수 있도록 한다. 예) kr.sonub.com 또는 us.sonub.com
    - 해외에서 접속하면,
      - 사용자가 속한 국가로 바로 갈 수 있도록 강조 버튼을 보여준다.
      - 그리고, 추가로 국가 선택 박스를 보여주고, 국가를 선택해서 해당 도메인으로 이동한다.
    
  - 선택한 국가가 sonub.com 의 메인 도메인이 아니면,
      예) apple.sonub.com 또는 philov.com(다른 메인)과 같이 다른 도메인의 메인 카페, 또는 banana.philov.com 등.
    - 현재 도메인에 카페가 존재하는지 확인하고, 존재하면, 그 카페 정보를 이용해서, 카페를 보여준다.
    - 카페가 존재하지 않으면, 그 도메인의 루트 도메인을 가지고, `CAFE_COUNTRY_DOMAINS` 에 있는 국가 정보를 바탕으로 그 국가 카페의 메인 정보를 보여준다.
    
  - 카페를 생성하려는 경우, 현재 접속 도메인의 루트 도메인이 `CAFE_COUNTRY_DOMAINS` 에 있으면, 그 국가가 자동으로 적용(고정)된다. 즉, 국가 선택창을 보여주지 않는다.
    
  - sonub.com, philov.com 또는 기타 다른 메인 도메인에 접속했으면, 카페 생성 버튼을 강조해서 보여준다.
    
  - 메인 도메인이 아니라, 카페이면, 카페 생성 링크를 잘 안보이게 한다.
  

* 최상위 README.md 파일의 카페 기능 참고.
  
* 카페 관리자 페이지를 간단하게 제공.
* 카페별, 루트사이트별 푸시를 보낼 수 있어야 한다. 카페별 푸시는 각 푸시 레코드에 도메인이 기록되므로 괜찮다. 루트사이트별 푸시는 루트도메인이 따로 기록되어야한다.
* 카페별 푸시 토큰이 몇개가 있는지 보여준다.
* 이전 소너브에서 만든 환율 위젯을 그대로 사용한다.

- email & password 로 가입 & 로그인을 할 수 있는 email 주로를 sonub.config.php 에서 제한을 한다.
* 네이버,카톡 로그인
* 패스로그인
* IE 9 부터 지원. Bootstrap 4 를 사용.
  * Vue 3 는 IE 에서도는 동작하지 않지만, 디자인에 문제가 생기지 않도록 한다. 즉, 글/코멘트/사진을 보여 줄 때, Vue 3 와 상관 없이 보여준다.
  
* PHP 8 을 사용하므로, 별도 서버를 운영해야 함. 위세너 호스팅 서버를 따로 하나 만들 것.
* Firebase Lazy load
  - https://firebase.google.com/docs/web/setup#delay-sdks-cdn

* 카페에서는 카페 개설을 작은 메뉴로만 보여준다.




# 실제 서버 설정 및 개발환경 설정

- 로그인
  - 로컬/원격: 네이버 chonyoungsoon:As****** 로 로그인.
  - 원격: 패스로그인: 010-8693-4225 및 기타 카톡, 네이버 로그인.
  - 관리자: email&password 로그인. 관리자 메일 주소: thruthesky@gmail.com
- xxx.philov.com 은 Go Get SSL 에 2차 도메인이 되는 SSL 을 구매했다.
  - apple, banana, cherry 도메인의 경우, 로컬에서 테스트 하면서 사용하는 도메인이다.
- xxx.philov.com 의 경우, 필리핀 도메인을 쓴다. 이 때, 카페 생성시, 국가는 필리핀으로 기본 선택하게 한다.



# 기획 및 구조

- 루트 readme.md 파일 참고


## 도메인과 카페

- 카페 메인 도메인은 여러개 일 수 있다.
  예를 들어, `CAFE_COUNTRY_DOMAINS` 에 기록된 philov.com 의 경우, philov.com 뿐만아니라, www.philov.com 이나, main.philov.com 등 여러가지
  도메인이 메인 도메인이 될 수 있다.
  이 때, 어느 도메인이 main domain 인지 아닌지 판별하는 방법은 현재 접속한 도메인이 `CAFE_MAIN_DOMAINS` 에 있으면 메인 도메인이다.
  그리고, 현재 접속 도메인의 root domain 이 `CAFE_COUNTRY_DOMAINS` 에 있으면, 카페의 국가가 그 속성의 `countryCode` 에 있는 국가에 속한다.


# 회원 가입 및 로그인

- Email 과 Password 로 가입 및 로그인이 가능하지만, 별 쓸모 없다.
  - provider 에 값이 없으면, 글 등록 및 기타를 할 수 없다.
  - 하지만, 관리자의 경우, 이메일을 config.php 에서 지정하므로, 특정한 이메일 주소로 가입을 할 필요가 있다.
    가입 & 로그인 URL 은 `&p=user.register` 로 접속을 하면 된다.
    

# 배너

- 배너 1번 크기. Bootstrap 4 의 col-3 의 너비가 255px 이다. 그래서 배너 1번 크기를 255 x 100 으로 통일한다.
  - 이 배너 크기를 날개 배너 등. 가능한 많은 곳에서 사용한다.
  
```css
.banner-255x100 {
    width: 255px;
    height: 100px;
}
```

- 배너 2번 크기. 정사각형 배너로 다자인을 하기 쉽고 활용을 할 곳도 많다.
  - 배너의 기본 크기는 320x320 로 제작하지만, 가능한 모든 장소에서 비율을 유지한채, 더 작게 보일 수 있다.
  